From 90739aec1dcc19bd8d9fb84c42ed9880f4982290 Mon Sep 17 00:00:00 2001
From: Stefan Sayer <stefan.sayer@googlemail.com>
Date: Mon, 16 Apr 2012 15:14:58 +0200
Subject: [PATCH] b/f: fix 2335abf803 for sending with empty message body

---
 core/AmSipSubscription.cpp |   18 +++++++++---------
 1 file changed, 9 insertions(+), 9 deletions(-)

diff --git a/core/AmSipSubscription.cpp b/core/AmSipSubscription.cpp
index 2825581..3fbeab1 100644
--- a/core/AmSipSubscription.cpp
+++ b/core/AmSipSubscription.cpp
@@ -117,6 +117,12 @@ string AmSipSubscription::getSubscribeHdrs() {
   return hdrs;
 }
 
+#ifdef HAVE_SEMS_OA
+# define DLG_SENDREQ_EMPTY_BODY NULL
+#else
+# define DLG_SENDREQ_EMPTY_BODY "", ""
+#endif
+
 bool AmSipSubscription::doSubscribe() 
 {
   bool res = true;
@@ -132,13 +138,7 @@ bool AmSipSubscription::doSubscribe()
     dlg.outbound_proxy = AmConfig::OutboundProxy;
   }
 
-  if (dlg.sendRequest(req.method,
-#ifdef HAVE_SEMS_OA
-		      NULL,
-#else
-		      "", "",
-#endif
-		      getSubscribeHdrs()) < 0) {
+  if (dlg.sendRequest(req.method, DLG_SENDREQ_EMPTY_BODY, getSubscribeHdrs()) < 0) {
     WARN("failed to send subscription to '%s' (proxy '%s').\n",
 	 dlg.remote_uri.c_str(), dlg.outbound_proxy.c_str());
     return false;
@@ -158,7 +158,7 @@ bool AmSipSubscription::doSubscribe()
 
 bool AmSipSubscription::reSubscribe() 
 {
-  if (dlg.sendRequest(req.method, NULL, getSubscribeHdrs()) < 0) {
+  if (dlg.sendRequest(req.method, DLG_SENDREQ_EMPTY_BODY, getSubscribeHdrs()) < 0) {
     WARN("failed to send subscription to '%s' (proxy '%s').\n",
 	 dlg.remote_uri.c_str(), dlg.outbound_proxy.c_str());
     return false;
@@ -196,7 +196,7 @@ bool AmSipSubscription::doUnsubscribe()
   }
   hdrs += SIP_HDR_COLSP(SIP_HDR_EXPIRES) "0" CRLF;
 
-  if (dlg.sendRequest(req.method, NULL, hdrs) < 0) {
+  if (dlg.sendRequest(req.method, DLG_SENDREQ_EMPTY_BODY, hdrs) < 0) {
     WARN("failed to send unsubscription to '%s' (proxy '%s').\n",
 	 dlg.remote_uri.c_str(), dlg.outbound_proxy.c_str());
     return false;
-- 
1.7.10.4

