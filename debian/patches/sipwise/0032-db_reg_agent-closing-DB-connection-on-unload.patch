From df480e790aa6618f18cae6299249190c80919bbf Mon Sep 17 00:00:00 2001
From: Stefan Sayer <stefan.sayer@frafos.com>
Date: Thu, 13 Oct 2011 12:21:42 +0200
Subject: [PATCH] db_reg_agent: closing DB connection on unload

---
 apps/db_reg_agent/DBRegAgent.cpp |    7 +++++++
 apps/db_reg_agent/DBRegAgent.h   |    2 ++
 2 files changed, 9 insertions(+)

diff --git a/apps/db_reg_agent/DBRegAgent.cpp b/apps/db_reg_agent/DBRegAgent.cpp
index c2ee4ca..8adc556 100644
--- a/apps/db_reg_agent/DBRegAgent.cpp
+++ b/apps/db_reg_agent/DBRegAgent.cpp
@@ -239,6 +239,13 @@ int DBRegAgent::onLoad()
   return 0;
 }
 
+void DBRegAgent::onUnload() {
+  DBG("closing main DB connection\n");
+  MainDBConnection.disconnect();
+  DBG("closing auxiliary DB connection\n");
+  ProcessorDBConnection.disconnect();
+}
+
 bool DBRegAgent::loadRegistrations() {
   try {
     time_t now_time = time(NULL);
diff --git a/apps/db_reg_agent/DBRegAgent.h b/apps/db_reg_agent/DBRegAgent.h
index a33ff7b..9ea3903 100644
--- a/apps/db_reg_agent/DBRegAgent.h
+++ b/apps/db_reg_agent/DBRegAgent.h
@@ -157,6 +157,8 @@ class DBRegAgent
 
   int onLoad();
 
+  void onUnload();
+
   RegistrationTimer registration_scheduler;
   DBRegAgentProcessorThread registration_processor;
 
-- 
1.7.10.4

