From 875a4cbc5efb16e53b179a54318b91e59658a607 Mon Sep 17 00:00:00 2001
From: Stefan Sayer <stefan.sayer@googlemail.com>
Date: Tue, 29 May 2012 19:01:33 +0200
Subject: [PATCH] early_dbprompt: loop mode

---
 apps/early_dbprompt/early_dbprompt.dsm |   15 ++++++++++-----
 1 file changed, 10 insertions(+), 5 deletions(-)

diff --git a/apps/early_dbprompt/early_dbprompt.dsm b/apps/early_dbprompt/early_dbprompt.dsm
index bd383f7..9abc490 100644
--- a/apps/early_dbprompt/early_dbprompt.dsm
+++ b/apps/early_dbprompt/early_dbprompt.dsm
@@ -4,11 +4,12 @@
 --   o replies with final reply code/reason from P-App-Param
 --
 -- Parameters (P-App-Param):
---    audio_id   - indicating audio file in DB; must be wav 16 bit pcm format (with wav header)
---    fr_code    - final reply code
---    fr_reason  - final reply reason
+--    audio_id    - indicating audio file in DB; must be wav 16 bit pcm format (with wav header)
+--    fr_code     - final reply code
+--    fr_reason   - final reply reason
+--    play_looped - "yes" to play the prompt in loop
 --
---  Example: P-App-Param: audio_id=rbt;fr_code=404;fr_reason="Not found"
+--  Example: P-App-Param: audio_id=rbt;play_looped=yes;fr_code=404;fr_reason="Not found"
 
 import(mod_utils);
 import(mod_dlg);
@@ -33,7 +34,11 @@ transition "invite" START - invite / {
     mysql.connect();
     throwOnError();
     -- play waiting file from DB
-    mysql.playDBAudio(SELECT data FROM provisioning.audio_files WHERE id="$audio_id", rbt.wav);
+    if test($play_looped=="yes") {
+      mysql.playDBAudioLooped(SELECT data FROM provisioning.audio_files WHERE id="$audio_id", rbt.wav);
+    } else {
+      mysql.playDBAudio(SELECT data FROM provisioning.audio_files WHERE id="$audio_id", rbt.wav);
+    }
     throwOnError();
     mysql.disconnect();
   }
-- 
1.7.10.4

